From afa88ca91f3a04a9199f055001cafa7ee495ab86 Mon Sep 17 00:00:00 2001
From: Tim S <tim.stahlhut@gmail.com>
Date: Sat, 26 Jan 2019 04:20:56 -0500
Subject: df modified source files

This patch is based on the work of 
David Flamand https://gitlab.com/dfffffff/newlib-6809

---
 newlib/libc/stdlib/mallocr.c                  |   4 +

diff --git a/newlib/libc/stdlib/mallocr.c b/newlib/libc/stdlib/mallocr.c
index e7cdace..2b40bf0 100644
--- a/newlib/libc/stdlib/mallocr.c
+++ b/newlib/libc/stdlib/mallocr.c
@@ -303,8 +303,10 @@ extern "C" {
 #define HAVE_MMAP 0
 #define MORECORE(size) _sbrk_r(reent_ptr, (size))
 #define MORECORE_CLEARS 0
+#ifndef __SINGLE_THREAD__
 #define MALLOC_LOCK __malloc_lock(reent_ptr)
 #define MALLOC_UNLOCK __malloc_unlock(reent_ptr)
+#endif
 
 #ifdef __CYGWIN__
 # undef _WIN32
@@ -319,6 +321,7 @@ extern "C" {
 #endif
 #endif
 
+#ifndef __SINGLE_THREAD__
 #if __STD_C
 extern void __malloc_lock(struct _reent *);
 extern void __malloc_unlock(struct _reent *);
@@ -326,6 +329,7 @@ extern void __malloc_unlock(struct _reent *);
 extern void __malloc_lock();
 extern void __malloc_unlock();
 #endif
+#endif
 
 #if __STD_C
 #define RARG struct _reent *reent_ptr,
